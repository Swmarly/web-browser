<!--
Copyright 2023 The Chromium Authors
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.

This file is used to generate a comprehensive list of Prefetch histograms
along with a detailed description for each histogram.

For best practices on writing histogram descriptions, see
https://chromium.googlesource.com/chromium/src.git/+/HEAD/tools/metrics/histograms/README.md

Please follow the instructions in the OWNERS file in this directory to find a
reviewer. If no OWNERS file exists, please consider signing up at
go/reviewing-metrics (Googlers only), as all subdirectories are expected to
have an OWNERS file. As a last resort you can send the CL to
chromium-metrics-reviews@google.com.
-->

<histogram-configuration>

<histograms>

<variants name="ExperimentalPreloadingPrediction">
  <variant name="OnPointerHoverWithMotionEstimator"
      summary="Predictor based on pointer hover, except if the pointer
               velocity and acceleration suggest it will leave soon. The
               output of this predictor is mouse velocity instead of a
               logit/probability."/>
  <variant name="OnPreloadingHeuristicsMLModel"
      summary="The estimated probability that a user will click on a link
               that is calculated by preloading heuristic ML model."/>
</variants>

<variants name="GroundTruth">
  <variant name="Negative" summary=""/>
  <variant name="Positive" summary=""/>
</variants>

<variants name="PrefetchDataPipeTeeStateLoadingOrSizeExceeded">
  <variant name="Loading" summary=""/>
  <variant name="SizeExceeded" summary=""/>
</variants>

<variants name="PreloadingPredictor">
  <variant name="BackButtonHover"
      summary="When the user hovers their mouse over the back button."/>
  <variant name="BackGestureNavigation"
      summary="When overscroll that could trigger a back navigation starts."/>
  <variant name="ChromeCustomTabs"
      summary="When preloading is triggered by CCT prefetch API."/>
  <variant name="DefaultSearchEngine"
      summary="When preloading is triggered from the default search engine
               suggest service."/>
  <variant name="LinkRel"
      summary="When preloading is triggered by the 'rel' keyword embedded in
               the link element."/>
  <variant name="MouseBackButton"
      summary="When a mouse down of a mouse back button is seen."/>
  <variant name="MouseHoverOnNewTabPage"
      summary="When preloading is triggered by mouse hover NewTabPage on
               Desktop."/>
  <variant name="MouseHoverOrMouseDownOnBookmarkBar"
      summary="When preloading is triggered by mouse hover bookmarkbar or
               mouse down bookmark bar."/>
  <variant name="OmniboxDirectURLInput"
      summary="When preloading is triggered from the Omnibox DUI."/>
  <variant name="OmniboxMousePredictor"
      summary="When preloading is triggered from the default search suggest
               due to mousedown on a Omnibox Search suggestion."/>
  <variant name="OmniboxSearchPredictor"
      summary="When preloading is triggered from the default search suggest
               due to change in Omnibox selection."/>
  <variant name="PointerDownOnAnchor"
      summary="When a pointerdown event happens on a HTTP/HTTPS anchor."/>
  <variant name="PointerDownOnNewTabPage"
      summary="When preloading is triggered by mouse down NewTabPage on
               Desktop."/>
  <variant name="PreloadingHeuristicsMLModel"
      summary="When preloading is triggered by an ML model prediction."/>
  <variant name="SpeculationRules"
      summary="When preloading is triggered by the speculation rules."/>
  <variant name="TouchOnNewTabPage"
      summary="When preloading is triggered by Touch events on Android."/>
  <variant name="Unspecified" summary=""/>
  <variant name="UrlPointerDownOnAnchor"
      summary="When preloading is triggered by OnPointerDown."/>
  <variant name="UrlPointerHoverOnAnchor"
      summary="When preloading is triggered by OnPointerHover."/>
  <variant name="ViewportHeuristic"
      summary="When preloading is triggered by a deterministic viewport-based
               heuristic."/>
</variants>

<variants name="PreloadingType">
  <variant name="NoStatePrefetch" summary=""/>
  <variant name="Preconnect" summary=""/>
  <variant name="Prefetch" summary=""/>
  <variant name="Prerender" summary=""/>
  <variant name="Unspecified" summary=""/>
</variants>

<variants name="PreloadServingMetricsActualMatchSuffix">
  <variant name="" summary="No condition"/>
  <variant name=".ForActualMatch"
      summary="Recorded if the match ended as actual match."/>
  <variant name=".ForNotActualMatch"
      summary="Recorded if the match started as potential match but ended as
               not actual match."/>
</variants>

<variants name="PreloadServingMetricsPrefix">
  <variant name="PreloadServingMetrics.ForNavigationCommitted"
      summary="Recorded when a navigation is committed. Doesn't include a
               prerender initial navigation. Metrics are about the
               navigation."/>
  <variant name="PreloadServingMetrics.ForPrerenderInitialNavigationFailed"
      summary="Recorded when a prerender initial navigation failed. Metrics
               are about the prerender initial navigation."/>
  <variant
      name="PreloadServingMetrics.ForPrerenderInitialNavigationFailed.WithMatchDurationGe10000"
      summary="Recorded when a prerender initial navigation failed and the
               first prefetch matching took duration greater than or equal to
               10000ms. Metrics are about the prerender initial navigation."/>
  <variant name="PreloadServingMetrics.ForPrerenderInitialNavigationUsed"
      summary="Recorded when a prerender activation is committed. Metrics are
               about the prerender initial navigation that is used."/>
</variants>

<variants name="WithPreloadSuffix">
  <variant name="WithoutPreload"
      summary="Recorded for a navigation without preloads."/>
  <variant name="WithPrefetch"
      summary="Recorded for a navigation used prefetch."/>
  <variant name="WithPrerender"
      summary="Recorded for a navigation used prerender."/>
</variants>

<histogram name="Preloading.Experimental.UpdateSpeculationCandidatesReason"
    enum="PreloadingUpdateSpeculationCandidatesReason"
    expires_after="2024-09-29">
  <owner>taiyo@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    This metric counts the number of the update of speculation rules preloading,
    classified by the reason for updates. Currently, this is introduced to
    measure the overall impact of BFCache retrigger(crbug.com/1449163). This
    metric is recorded when UpdateSpeculationCandidates is called on
    DocumentSpeculationRules.
  </summary>
</histogram>

<histogram
    name="Preloading.Experimental.{ExperimentalPreloadingPrediction}.{GroundTruth}"
    units="param" expires_after="2025-04-13">
  <owner>isaboori@google.com</owner>
  <owner>spelchat@chromium.org</owner>
  <owner>jbroman@chromium.org</owner>
  <owner>portals-team@google.com</owner>
  <summary>
    The output of many predictors is a logit score. To use this score for binary
    classification, we compare it to a threshold. If the score is above the
    threshold, we classify the instance as positive; otherwise, we classify it
    as negative. Threshold choice affects classifier precision and recall. There
    is a trade-off between precision and recall. If we set the threshold too
    low, we will have high precision but low recall. If we set the threshold too
    high, we will have high recall but low precision. To choose the best
    threshold, we can use ROC curves, precision-recall curves, or
    logit-precision and logit-recall curves. `ExperimentalPreloadingPrediction`
    helps us collect the UMA data required to achieve this.
  </summary>
  <token key="ExperimentalPreloadingPrediction"
      variants="ExperimentalPreloadingPrediction"/>
  <token key="GroundTruth" variants="GroundTruth"/>
</histogram>

<histogram name="Preloading.Predictor.{PreloadingPredictor}.Precision"
    enum="PredictorConfusionMatrix" expires_after="2026-03-01">
  <owner>isaboori@google.com</owner>
  <owner>spelchat@chromium.org</owner>
  <owner>sreejakshetty@chromium.org</owner>
  <owner>jbroman@chromium.org</owner>
  <owner>chrome-brapp-loading@chromium.org</owner>
  <summary>
    After the user starts a new navigation, the outcome of the
    {PreloadingPredictor} preloading predictor is recorded as a true positive or
    a false positive. These statistics are used to compute precision of the
    preloading predictor. The statistics about negative cases are not required
    to compute the precision and are not recorded here.
  </summary>
  <token key="PreloadingPredictor" variants="PreloadingPredictor"/>
</histogram>

<histogram name="Preloading.Predictor.{PreloadingPredictor}.Recall"
    enum="PredictorConfusionMatrix" expires_after="2026-03-01">
  <owner>isaboori@google.com</owner>
  <owner>spelchat@chromium.org</owner>
  <owner>sreejakshetty@chromium.org</owner>
  <owner>jbroman@chromium.org</owner>
  <owner>chrome-brapp-loading@chromium.org</owner>
  <summary>
    After the user starts a new navigation, the outcome of any eligible
    {PreloadingPredictor} preloading predictor is recorded as a true positive or
    a false negative. These statistics are used to compute recall of the
    preloading predictor. The statistics about false positive and true negative
    cases are not required to compute the recall and are not recorded here.
  </summary>
  <token key="PreloadingPredictor" variants="PreloadingPredictor"/>
</histogram>

<histogram
    name="Preloading.Prefetch.PrefetchDataPipeTeeCloneFailed.{PrefetchDataPipeTeeStateLoadingOrSizeExceeded}"
    units="count" expires_after="2026-03-01">
  <owner>kenoss@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    Records how many times `PrefetchDataPipeTee::Clone()` is called when the
    method failed.

    {PrefetchDataPipeTeeStateLoadingOrSizeExceeded} indicates
    `PrefetchDataPipeTee::State` at the failure.

    It is used for investigation crbug.com/374039756.
  </summary>
  <token key="PrefetchDataPipeTeeStateLoadingOrSizeExceeded"
      variants="PrefetchDataPipeTeeStateLoadingOrSizeExceeded"/>
</histogram>

<histogram name="Preloading.Prefetch.PrefetchDataPipeTeeDtorState"
    enum="PrefetchDataPipeTeeState" expires_after="2026-03-01">
  <owner>kenoss@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    Records the `PrefetchDataPipeTee::State` at `PrefetchDataPipeTee`'s
    destructor.

    It is used for investigation crbug.com/374039756.
  </summary>
</histogram>

<histogram
    name="Preloading.Prefetch.PrefetchResponseReaderCreateRequestHandlerInvalidBody"
    units="bool" expires_after="2025-04-17">
  <owner>kenoss@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    Records `true` when `PrefetchResponseReader::CreateRequestHandler` couldn't
    get valid `body`. `false` is never recorded.

    It is used for investigation crbug.com/374039756.
  </summary>
</histogram>

<histogram name="Preloading.Prefetch.PrefetchStatus"
    enum="PrefetchProxyPrefetchStatus" expires_after="2026-04-12">
  <owner>adithyas@chromium.org</owner>
  <owner>portals-team@google.com</owner>
  <summary>
    Records the final PrefetchStatus value for a PrefetchContainer. The value is
    recorded when a prefetch fails (in the failure case), or when the
    PrefetchContainer is destroyed (in all other cases).
  </summary>
</histogram>

<histogram name="Preloading.PrefetchBCGSwap.RelatedActiveContents"
    units="contents" expires_after="2024-06-30">
  <owner>jbroman@chromium.org</owner>
  <owner>portals-team@google.com</owner>
  <summary>
    Records the number of active contents in the same BrowsingInstance as a
    frame which is, or would be, swapped to a new one due to use of a cross-site
    prefetch, when this determination is being made on navigation. The
    proportion of these which is greater than 1 is a rough upper bound for the
    cases where this might be observable due to an opener relationship.
  </summary>
</histogram>

<histogram
    name="Preloading.PrerenderBackNavigationEligibility.{PreloadingPredictor}"
    enum="PrerenderBackNavigationEligibility" expires_after="2025-10-06">
  <owner>mcnee@chromium.org</owner>
  <owner>chrome-brapp-loading@chromium.org</owner>
  <summary>
    Records whether prerendering a back navigation is possible at the time of
    the prediction of a back navigation by {PreloadingPredictor}.
  </summary>
  <token key="PreloadingPredictor" variants="PreloadingPredictor"/>
</histogram>

<histogram
    name="Preloading.{PreloadingType}.Attempt.{PreloadingPredictor}.Precision"
    enum="PredictorConfusionMatrix" expires_after="2026-03-01">
  <owner>isaboori@google.com</owner>
  <owner>spelchat@chromium.org</owner>
  <owner>sreejakshetty@chromium.org</owner>
  <owner>jbroman@chromium.org</owner>
  <owner>chrome-brapp-loading@chromium.org</owner>
  <summary>
    After the user starts a new navigation, the outcome of the preloading
    attempt of type {PreloadingType} that is triggered by {PreloadingPredictor}
    is recorded as a true positive or a false positive. These statistics are
    used to compute precision of the preloading attempt. The statistics about
    negative cases are not required to compute the precision and are not
    recorded here.
  </summary>
  <token key="PreloadingType" variants="PreloadingType"/>
  <token key="PreloadingPredictor" variants="PreloadingPredictor"/>
</histogram>

<histogram
    name="Preloading.{PreloadingType}.Attempt.{PreloadingPredictor}.Recall"
    enum="PredictorConfusionMatrix" expires_after="2026-02-22">
  <owner>isaboori@google.com</owner>
  <owner>spelchat@chromium.org</owner>
  <owner>sreejakshetty@chromium.org</owner>
  <owner>jbroman@chromium.org</owner>
  <owner>chrome-brapp-loading@chromium.org</owner>
  <summary>
    After the user starts a new navigation, the outcome of any eligible
    preloading attempt of type {PreloadingType} that is triggered by
    {PreloadingPredictor} or the lack of an attempt by an eligible predictor is
    recorded as a true positive or a false negative. These statistics are used
    to compute recall of the preloading attempt. The statistics about false
    positive and true negative cases are not required to compute the recall and
    are not recorded here.
  </summary>
  <token key="PreloadingType" variants="PreloadingType"/>
  <token key="PreloadingPredictor" variants="PreloadingPredictor"/>
</histogram>

<histogram
    name="Preloading.{PreloadingType}.Attempt.{PreloadingPredictor}.TriggeringOutcome"
    enum="PreloadingTriggeringOutcome" expires_after="2026-02-22">
  <owner>spelchat@chromium.org</owner>
  <owner>sreejakshetty@chromium.org</owner>
  <owner>jbroman@chromium.org</owner>
  <owner>liuwilliam@chromium.org</owner>
  <owner>chrome-brapp-loading@chromium.org</owner>
  <summary>
    Records the triggering outcome of a preloading attempt of type
    {PreloadingType} and triggered by {PreloadingPredictor} that happened on the
    previous page load at the time a new navigation is started.
  </summary>
  <token key="PreloadingType" variants="PreloadingType"/>
  <token key="PreloadingPredictor" variants="PreloadingPredictor"/>
</histogram>

<histogram
    name="PreloadServingMetrics.PageLoad.Clients.PaintTiming.NavigationToFirstContentfulPaint.{WithPreloadSuffix}"
    units="ms" expires_after="2026-03-15">
  <owner>kenoss@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    FirstContentfulPaint.

    Recorded when {WithPreloadSuffix}.
  </summary>
  <token key="WithPreloadSuffix" variants="WithPreloadSuffix"/>
</histogram>

<histogram
    name="{PreloadServingMetricsPrefix}.PrefetchMatchMetrics.ActualMatchThen.TimeFromPrefetchContainerAddedToMatchStart"
    units="ms" expires_after="2026-03-22">
  <owner>kenoss@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    The duration from when the used prefetch container is added to the start of
    prefetch matching.

    Recorded when {PreloadServingMetricsPrefix} and the prefetch matching ended
    as actual match.
  </summary>
  <token key="PreloadServingMetricsPrefix"
      variants="PreloadServingMetricsPrefix"/>
</histogram>

<histogram name="{PreloadServingMetricsPrefix}.PrefetchMatchMetrics.Count"
    units="count" expires_after="2026-03-22">
  <owner>kenoss@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    The number of prefetches that are matched with a navigation.

    Recorded when {PreloadServingMetricsPrefix}.
  </summary>
  <token key="PreloadServingMetricsPrefix"
      variants="PreloadServingMetricsPrefix"/>
</histogram>

<histogram
    name="{PreloadServingMetricsPrefix}.PrefetchMatchMetrics.IsPotentialMatch"
    units="bool" expires_after="2026-03-22">
  <owner>kenoss@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    Whether the first prefetch matching for a navigation started as potential
    match.

    Recorded when {PreloadServingMetricsPrefix}.
  </summary>
  <token key="PreloadServingMetricsPrefix"
      variants="PreloadServingMetricsPrefix"/>
</histogram>

<histogram
    name="{PreloadServingMetricsPrefix}.PrefetchMatchMetrics.IsPotentialMatch.WithAheadOfPrerender"
    units="bool" expires_after="2026-03-22">
  <owner>kenoss@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    Whether the first prefetch matching for a navigation started as potential
    match with prefetch ahead of prerender.

    Recorded when {PreloadServingMetricsPrefix} and the navigation is prerender
    initial navigation.
  </summary>
  <token key="PreloadServingMetricsPrefix"
      variants="PreloadServingMetricsPrefix"/>
</histogram>

<histogram
    name="{PreloadServingMetricsPrefix}.PrefetchMatchMetrics.PotentialMatchThen.IsActualMatch"
    units="bool" expires_after="2026-03-22">
  <owner>kenoss@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    Whether the first prefetch matching for a navigation ended as actual match.

    Recorded when {PreloadServingMetricsPrefix}.
  </summary>
  <token key="PreloadServingMetricsPrefix"
      variants="PreloadServingMetricsPrefix"/>
</histogram>

<histogram
    name="{PreloadServingMetricsPrefix}.PrefetchMatchMetrics.PotentialMatchThen.MatchDuration{PreloadServingMetricsActualMatchSuffix}"
    units="ms" expires_after="2026-03-22">
  <owner>kenoss@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    Duration for the first prefetch matching for a navigation.

    Recorded when {PreloadServingMetricsPrefix}, the first prefetch matching
    started as potential match, and {PreloadServingMetricsActualMatchSuffix}.
  </summary>
  <token key="PreloadServingMetricsPrefix"
      variants="PreloadServingMetricsPrefix"/>
  <token key="PreloadServingMetricsActualMatchSuffix"
      variants="PreloadServingMetricsActualMatchSuffix"/>
</histogram>

<histogram
    name="{PreloadServingMetricsPrefix}.PrefetchMatchMetrics.PotentialMatchThen.NumberOfInitialCandidates"
    units="count" expires_after="2026-03-22">
  <owner>kenoss@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    The number of initial candidates of the first prefetch matching for a
    navigation.

    Recorded when {PreloadServingMetricsPrefix} and the first prefetch matching
    started as a potential match.
  </summary>
  <token key="PreloadServingMetricsPrefix"
      variants="PreloadServingMetricsPrefix"/>
</histogram>

<histogram
    name="{PreloadServingMetricsPrefix}.PrefetchMatchMetrics.PotentialMatchThen.NumberOfInitialCandidatesBlockUntilHead"
    units="count" expires_after="2026-03-22">
  <owner>kenoss@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    The number of blocking initial candidates of the first prefetch matching for
    a navigation.

    Recorded when {PreloadServingMetricsPrefix} and the first prefetch matching
    started as a potential match.
  </summary>
  <token key="PreloadServingMetricsPrefix"
      variants="PreloadServingMetricsPrefix"/>
</histogram>

<histogram
    name="{PreloadServingMetricsPrefix}.PrefetchMatchMetrics.PotentialMatchThen.WithAheadOfPrerender.PotentialCandidateServingResult"
    enum="PrefetchPotentialCandidateServingResult" expires_after="2026-03-22">
  <owner>kenoss@chromium.org</owner>
  <owner>chrome-prerendering@google.com</owner>
  <summary>
    `PrefetchPotentialCandidateServingResult` of prefetch ahead of prerender in
    the first prefetch matching.

    Recorded when {PreloadServingMetricsPrefix}, the navigation is prerender
    initial navigation, and the prefetch ahead of prerender is potential match.
  </summary>
  <token key="PreloadServingMetricsPrefix"
      variants="PreloadServingMetricsPrefix"/>
</histogram>

</histograms>

</histogram-configuration>
