From 263353b217d35ee4c88a0076157d989dd41dc434 Mon Sep 17 00:00:00 2001
From: Lukasz Anforowicz <lukasza@chromium.org>
Date: Thu, 4 Sep 2025 17:01:13 +0000
Subject: [PATCH] Ignore acTL chunks with num_frames == 0.

(Corresponds to https://github.com/image-rs/image-png/pull/607).
---
 .../vendor/png-v0_18/src/decoder/stream.rs                   | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/third_party/rust/chromium_crates_io/vendor/png-v0_18/src/decoder/stream.rs b/third_party/rust/chromium_crates_io/vendor/png-v0_18/src/decoder/stream.rs
index eb79e6cec0c6f..8a2ac4f5e9f4e 100644
--- a/third_party/rust/chromium_crates_io/vendor/png-v0_18/src/decoder/stream.rs
+++ b/third_party/rust/chromium_crates_io/vendor/png-v0_18/src/decoder/stream.rs
@@ -1121,6 +1121,11 @@ impl StreamingDecoder {
                 num_frames: buf.read_be()?,
                 num_plays: buf.read_be()?,
             };
+            // The spec says that "0 is not a valid value" for `num_frames`.
+            // So let's ignore such malformed `acTL` chunks.
+            if actl.num_frames == 0 {
+                return Ok(Decoded::Nothing);
+            }
             self.info.as_mut().unwrap().animation_control = Some(actl);
             Ok(Decoded::AnimationControl(actl))
         }
-- 
2.51.0.355.g5224444f11-goog

