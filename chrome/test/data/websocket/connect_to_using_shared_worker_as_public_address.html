<!DOCTYPE html>
<html>
<head>
<title>test ws connection</title>
<script type="text/javascript">

const href = window.location.href;
const queryBegin = href.indexOf('?url=');
if (queryBegin == -1) {
  console.log("Failed to find ?url= in URL");
  document.title = 'FAIL';
  throw "FAILURE";
}
const url = href.slice(queryBegin + 5);

const workerConnection = new Promise(async (resolve, reject) => {
  const worker = new SharedWorker('connect_to_using_shared_worker_as_public_address.js');

  worker.port.onmessage = event => {
    if (event.data === 'PASS') {
      resolve();
    } else if (event.data === 'FAIL') {
      reject();
    }
  };
  worker.port.start();
  worker.port.postMessage({url});
});

workerConnection.then(() => {
  // Set document title to 'PASS'. The test observer catches this title changes
  // to know the result.
  document.title = 'PASS';
}, () => {
  // Set document title to 'FAIL'.
  document.title = 'FAIL';
});

</script>
</head>
</html>
